<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views
  http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
   
   <selection name="employee.designation.selection">
   	<option value="juniorDeveloper"> Junior Developer</option>
   	<option value="seniorDeveloper"> Senior Developer</option>
   	<option value="frontendDeveloper"> Frontend Developer</option>
   	<option value="tester"> Tester</option>
   	<option value="adminSupport">Admin Support  </option>
   </selection>
  
  
  <!-- 	<form name="emp-form" title="Employees Form" model="com.aop.company.db.Employee" width="large" onNew="ctc.show"> -->
  	<form name="emp-form" title="Employees Form" model="com.aop.company.db.Employee" width="large" onSave="emp-detail-check" >
	  <panel name="nameDetail-panel" title="Employee Overview">
	    <field name="empFullName" readonly="false">
	      <editor>
	        <field name="firstName" />
	        <field name="lastName"/>
	      </editor>
	    </field>
	    <field name="dob"/>
	  </panel>
	  
	  <panel name="contactDetail-panel" >
	    <field name="email" >
	      <viewer><![CDATA[ 
	      	<a href="mailto:{{record.email}}">{{record.email}}</a>
	  	  ]]></viewer>
	    </field>
	    <field name="phone">
	      <viewer><![CDATA[
		  	<a href="tel:{{record.phone}}">{{record.phone}}</a>
	      ]]></viewer>
	    </field>
	  </panel>
	  
	  <panel name="deptmentDetail-panel">
	    <field name="designation" onChange="ctc.show"/> <!-- onchange action attribute -->
	    <field name="empDept" title="Department" x-target-name="departmentName" x-target="com.aop.company.db.Department" x-type="many-to-one"/>
	  </panel>
	  
	  <panel name="salary-panel">
	  <field name = "ctc" title="Employee Salary" >
	    <editor>
	   		 <field name="ctc" onChange="test.method.test"/>
	    </editor>
	    </field>
	    <field name="basic" readonly="true" />    
	    <field name="hra" title="HRA" readonly="true"/>
	    <field name="boa" titld="BOA" readonly="true"/>
	  </panel>
	    
	  <panel-related name="empPanel" field="projectSet">
	    <field name="projectName"/>
	    <field name="projectManager"/>
	    <field name="prStDate" title="Start Date"/>
	  </panel-related>
	</form>
	 
	<grid model="com.aop.company.db.Employee" title="Employee Detail" name="emp-grid">
	  <field name="empFullName" />
	  <field name="designation" />
	  <field name="empDept" title="Department"/>
	  <field name="email" />
	  <field name="ctc" title="CTC" />
	  <button name="btnInfo" icon="fa-info" title="Salary Breakdown" onClick="action-validate-ctc" />
	 <field name="phone" />

  	</grid>
  
   <cards name="emp-card" model="com.aop.company.db.Employee" title="Employee Id Card">
  	<field name="empFullName" />
  	<field name="phone" />
  	<field name="email" />
  	<field name="address" />
 	<field name="image" />
 	
      <template>
 		<![CDATA[
 			<div class="span4 card-image">
    			<img ng-if="hasImage" ng-src="{{$image(null, 'image')}}">
    			<img ng-if="!hasImage" src="img/user.png">
   				<strong>{{empFullName}}</strong>
  			</div>
  			<div class="span8">
		    <content>
		      <abbr ng-if="phone" title="Phone">P:</abbr> {{phone}}<br>
		      <abbr ng-if="email" title="Email">E:</abbr> {{email}}<br>
		    </content>
		   </div>	
 		]]> 	
 	</template>
  </cards>
  
  
 <!--  Extention views  -->
  
  <form model="com.aop.company.db.Employee" title="Employee" name="emp-form" id="employee-extention-form" extension="true" >
	<!-- <extend target="//field[@name='phone']"> 
		<replace>
			<field name="contact-details"/>
		</replace>
	</extend> -->
	
	<extend target="//field[@name='empFullName']"> 
		<replace>
			<field name="firstName"/>
			<field name="middleName"/>
			<field name="lastName"/>
		</replace>
	</extend>
  </form>
 
  <action-attrs name="ctc.show">
  	 <attribute for="ctc" name="readonly" expr="designation==null"  />
  </action-attrs>
  
  <action-method name="test.method.test">
  	<call class="com.axelor.test.TestClass" method="testMethod"/>
  </action-method>
 
  <action-method name="act1">
  	<call class="com.aop.company.web.SalaryController" method="SalaryDet"/>
  </action-method>
  
  <!-- <action-script name="act2" model="com.aop.company.db.Employee">
		<script language="js">
		<![CDATA[		
		var req= $request;
		var res=$response;
		var co = req.context;
		var ctc1 = co.get('ctc')
		var base = ctc1*0.4
		res.setFlash(base);		
		]]>		
		</script>
  </action-script> -->
  
  
  <action-validate name="check-ctc">
	  <error message="CTC cannot be less than one!!" if="eval: ctc &lt; 1" />
  </action-validate> 
  
  <action-group name="action-validate-ctc">
	  <action name="check-ctc"/>
	  <action name="act1" />
  </action-group> 
  

  
  <action-condition name="form-condition">
  		<check field="phone" error="Employee Phone Num cannot be Empty"/>
  		<check field="ctc" if="eval: ctc &lt; 1" error="CTC cannot be 0" />
  </action-condition>
  
  <action-validate name="ctc-validation">
  		<error if="eval: ctc &lt; 10000" message="CTC too low"/>  
  </action-validate>
  
  <action-script name="salary-calcu-script" model="com.aop.company.db.Employee">
  		<script language="js">
  			<![CDATA[ 
  				var req= $request;
				var res=$response;
				var co=req.context;
				var empCtc=co.get ('ctc');
				var basic=empCtc*0.4;
				var hra=empCtc*0.2;
				var boa=empCtc*0.4;
				res.setValue('basic', basic);
				res.setValue('hra', hra);
				res.setValue('boa', boa);
			]]>
  		</script>
  </action-script>
  
    <action-group name="emp-detail-check">
  		<action name="form-condition"/>
  		<action name="ctc-validation"/>
  		<action name="salary-calcu-script"/>
  </action-group>
  
  </object-views>